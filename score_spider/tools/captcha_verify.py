# -*- coding:utf-8 -*-
import difflib
from PIL import Image

threshold = 127

info = {
    "offsetWidth": 2,   #宽度偏移
    "offsetHeight": 4,  #高度偏移
    "wordNum": 4,       #字符数量
    "wordWidth": 12,    #字符宽度
    "wordHeight": 12,   #字符高度
    "wordSpace": -2     #字符空隙
}

keys = {
  "c": "111111111111111111111111111111111111111100001111111000000111110001100111110011111111110011111111110011111111110001100111111000001111111100001111",
  "b": "110011111111110011111111110011111111110010001111110000000111110001100011110011110011110011110011110011110011110001100011110000000111110010001111",
  "n": "111111111111111111111111111111111110110010000110110000000011110001110011110011110011110011110011110011110011110011110011110011110010110011110010",
  "1": "111110011111111100011111111000011110110010011110010110011111101110011111111110011111111110011111111110011111111110011111111110011110111110011110",
  "3": "111000001111110000000111100111100111011111100111101100001111110100001111111011000111111101100111100111100111100011000111110000001111111000011111",
  "2": "111000011111110000001111100011100111100111100111111111100111111111001111111110001111111100011111111000111111110011111111100000000111100000000111",
  "v": "111111111111111111111111111111111010110011100101110011100110110011100111111001001111111001001111111001001110111100011110111100011111111100011111",
  "x": "111111111111111111111111111111111111110011100111110001000111111001001111111100011111111100011111111100011111111001001111110001000111110011100111",
  "z": "111111111111111111111111111111111111110000000111110000000111111111001111111110001111111100011111111000111111111001111111110000000111110000000111"
}
def verify(data):
    codes = code = ""
    im = Image.open(data).convert('L')
    #分割单个字符
    for j in range(info['wordNum']):
        beginX = info['offsetWidth'] + (info['wordWidth'] + info['wordSpace']) * j
        beginY = info['offsetHeight']
        endX = beginX + info['wordWidth']
        endY = beginY + info['wordHeight']
        box = (beginX, beginY, endX, endY)
        imgData = ''.join(['1' if x > threshold else '0' for x in list(im.crop(box).getdata())])
        percent = maxPercent = 0.0
        #选取相似度最大的值
        for key in keys:
            percent = difflib.SequenceMatcher(None, imgData, keys[key]).ratio()
            if percent > maxPercent:
                maxPercent = percent
                code = key
        codes += code
    return codes

if __name__ == "__main__":
    print(verify("./1.png"))
